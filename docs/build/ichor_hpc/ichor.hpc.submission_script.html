<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ichor.hpc.submission_script package &mdash; ichor 3.1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->

        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ichor.hpc.useful_functions package" href="ichor.hpc.useful_functions.html" />
    <link rel="prev" title="ichor.hpc.submission_commands package" href="ichor.hpc.submission_commands.html" />
</head>

<body class="wy-body-for-nav">
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >



          <a href="../index.html" class="icon icon-home">
            ichor
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installing ichor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ichor_config_setup.html">Setting up ichor_config.yaml</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ichor_core_examples_toc.html">Examples for ichor.core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ichor_hpc_examples_toc.html">Examples for ichor.hpc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ichor_cli_examples_toc.html">Examples for ichor.cli</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">full documentation of source code</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ichor_core/ichor.core.html">ichor.core package</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="ichor.hpc.html">ichor.hpc package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="ichor.hpc.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ichor.hpc.batch_system.html">ichor.hpc.batch_system package</a></li>
<li class="toctree-l3"><a class="reference internal" href="ichor.hpc.log.html">ichor.hpc.log package</a></li>
<li class="toctree-l3"><a class="reference internal" href="ichor.hpc.main.html">ichor.hpc.main package</a></li>
<li class="toctree-l3"><a class="reference internal" href="ichor.hpc.molecular_dynamics.html">ichor.hpc.molecular_dynamics package</a></li>
<li class="toctree-l3"><a class="reference internal" href="ichor.hpc.submission_commands.html">ichor.hpc.submission_commands package</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">ichor.hpc.submission_script package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-ichor.hpc.submission_script.command_group">ichor.hpc.submission_script.command_group module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-ichor.hpc.submission_script.script_names">ichor.hpc.submission_script.script_names module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-ichor.hpc.submission_script.submission_script">ichor.hpc.submission_script.submission_script module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-ichor.hpc.submission_script">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ichor.hpc.useful_functions.html">ichor.hpc.useful_functions package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ichor.hpc.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="ichor.hpc.html#module-ichor.hpc.global_variables">ichor.hpc.global_variables module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ichor.hpc.html#module-ichor.hpc.submission_command">ichor.hpc.submission_command module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ichor.hpc.html#module-ichor.hpc.uid">ichor.hpc.uid module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ichor.hpc.html#module-ichor.hpc">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ichor_cli/ichor.cli.html">ichor.cli package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ichor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="ichor.hpc.html">ichor.hpc package</a></li>
      <li class="breadcrumb-item active">ichor.hpc.submission_script package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/ichor_hpc/ichor.hpc.submission_script.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <section id="ichor-hpc-submission-script-package">
<h1>ichor.hpc.submission_script package<a class="headerlink" href="#ichor-hpc-submission-script-package" title="Permalink to this heading"></a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this heading"></a></h2>
</section>
<section id="module-ichor.hpc.submission_script.command_group">
<span id="ichor-hpc-submission-script-command-group-module"></span><h2>ichor.hpc.submission_script.command_group module<a class="headerlink" href="#module-ichor.hpc.submission_script.command_group" title="Permalink to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.command_group.CommandGroup">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">CommandGroup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iterable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ichor.hpc.submission_script.command_group.CommandGroup" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="ichor.hpc.html#ichor.hpc.submission_command.SubmissionCommand" title="ichor.hpc.submission_command.SubmissionCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">SubmissionCommand</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></p>
<p>Wraps around jobs that are of the same type, i.e. Gaussian jobs, AIMALL jobs, FEREBUS jobs, ICHOR jobs.
Since each job uses the same settings, we can just use the 0th index.</p>
<dl class="py property">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.command_group.CommandGroup.arguments">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">arguments</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#ichor.hpc.submission_script.command_group.CommandGroup.arguments" title="Permalink to this definition"></a></dt>
<dd><p>Returns the arguments (if any) that need to be passed to the program that the job is going to execute.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.command_group.CommandGroup.command">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">command</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#ichor.hpc.submission_script.command_group.CommandGroup.command" title="Permalink to this definition"></a></dt>
<dd><p>Returns a string containing the command which is going to be ran (eg. g09 for Gaussian on CSF3.)</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.command_group.CommandGroup.data">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">data</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#ichor.hpc.submission_script.command_group.CommandGroup.data" title="Permalink to this definition"></a></dt>
<dd><p>Returns the data that a job needs.
This is usually a set of files which are the input files and the output files to be written by the job.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.command_group.CommandGroup.modules">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">modules</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">list</span></em><a class="headerlink" href="#ichor.hpc.submission_script.command_group.CommandGroup.modules" title="Permalink to this definition"></a></dt>
<dd><p>Retruns a string containing any modules that need to be loaded in order for a program to run</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.command_group.CommandGroup.ntypes">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">ntypes</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#ichor.hpc.submission_script.command_group.CommandGroup.ntypes" title="Permalink to this definition"></a></dt>
<dd><p>Returns the number of types of jobs that are in the command group.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.command_group.CommandGroup.options">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">options</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#ichor.hpc.submission_script.command_group.CommandGroup.options" title="Permalink to this definition"></a></dt>
<dd><p>Returns the options to write at the top of the submission script</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.command_group.CommandGroup.repr">
<span class="sig-name descname"><span class="pre">repr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">variables</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#ichor.hpc.submission_script.command_group.CommandGroup.repr" title="Permalink to this definition"></a></dt>
<dd><p>Return a string which represents the line in the job script which
runs the program (Gaussian, AIMALL, etc.) with its given inputs (typically these inputs are
in the form of a job array so they look like ${arr1[$SGE_TASK_ID-1]}</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-ichor.hpc.submission_script.script_names">
<span id="ichor-hpc-submission-script-script-names-module"></span><h2>ichor.hpc.submission_script.script_names module<a class="headerlink" href="#module-ichor.hpc.submission_script.script_names" title="Permalink to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.script_names.ScriptNames">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">ScriptNames</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">script_names</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parent</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">FileStructure</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">modify</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ichor.hpc.submission_script.script_names.ScriptNames" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></p>
<p>A helper class which returns the full path of a particular script that is used to submit job files
for programs like Gaussian and AIMAll. All the script files are stored into a directory
ichor.hpc.global_variables.FILE_STRUCTURE[“scripts”].
These scripts are submitted to compute nodes on CSF3/FFLUXLAB which initiates a job.</p>
<dl class="py property">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.script_names.ScriptNames.file_structure">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">file_structure</span></span><a class="headerlink" href="#ichor.hpc.submission_script.script_names.ScriptNames.file_structure" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-ichor.hpc.submission_script.submission_script">
<span id="ichor-hpc-submission-script-submission-script-module"></span><h2>ichor.hpc.submission_script.submission_script module<a class="headerlink" href="#module-ichor.hpc.submission_script.submission_script" title="Permalink to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">SubmissionScript</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">submission_script_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ncores</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cwd</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_nodes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_nodes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_running_tasks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputs_dir_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">errors_dir_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datafile_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class that can be used to construct submission scripts for various programs such as Gaussian and AIMALL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> – A path to a submission script (such as GAUSSIAN.sh and AIMALL.sh).
These .sh files are submitted as jobs to CSF3/FFLUXLAB.
These job scripts will have different contents depending on the number of cores selected,
the number of tasks to do (if running an array job), etc.,
so they need to be written out dynamically depending on what is going to be ran.</p></li>
<li><p><strong>submission_script_name</strong> – The name of the submission script</p></li>
<li><p><strong>ncores</strong> – Number of cores to run the job with</p></li>
<li><p><strong>cwd</strong> – The current working directory. If not set, defaults to Path.cwd()</p></li>
<li><p><strong>include_nodes</strong> – A list of node names to run the job on, defaults to None</p></li>
<li><p><strong>exclude_nodes</strong> – A list of node names to exclude running the job on, defaults to None</p></li>
<li><p><strong>max_running_tasks</strong> – Maximum number of tasks (of array job) that can run at once, defaults to -1</p></li>
<li><p><strong>outputs_dir_path</strong> – Path to the outputs directory. If not set, it will use the default global_variables one</p></li>
<li><p><strong>errors_dir_path</strong> – Path to the errors directory. If not set, it will use the default global_variables one</p></li>
<li><p><strong>datafile_path</strong> – Path to datafile containing information needed for job to run, defaults to None</p></li>
</ul>
</dd>
</dl>
<p>Example Gaussian submission script for SGE (array job):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>#!/bin/bash -l
#$ -o /net/scratch2/mbdxwym4/ammonia_with_derivatives/.DATA/SCRIPTS/OUTPUTS
#$ -pe smp.pe 2
#$ -wd /net/scratch2/mbdxwym4/ammonia_with_derivatives
#$ -e /net/scratch2/mbdxwym4/ammonia_with_derivatives/.DATA/SCRIPTS/ERRORS
#$ -t 1-10000
echo &quot;Loading Modules | $(date)&quot;
module load apps/binapps/gaussian/g09d01_em64t
export OMP_NUM_THREADS=2
echo &quot;Starting Job | $(date)&quot;
ICHOR_DATFILE=/net/scratch2/mbdxwym4/ammonia_with_derivatives/.DATA/JOBS/DATAFILES/dd644974-c430-449a-a8e1-d3540980bcb4
arr1=()
arr2=()
while IFS=, read -r var1 var2
do
    arr1+=($var1)
    arr2+=($var2)
done &lt; $ICHOR_DATFILE
if [ -n ${arr1[$SGE_TASK_ID-1]} ] &amp;&amp; [ -n ${arr2[$SGE_TASK_ID-1]} ]
then
export GAUSS_SCRDIR=$(dirname ${arr1[$SGE_TASK_ID-1]})
$g09root/g09/g09 ${arr1[$SGE_TASK_ID-1]} ${arr2[$SGE_TASK_ID-1]}
fi
echo &quot;Finished Job | $(date)&quot;
</pre></div>
</div>
<p>Example Gaussian submission script for SLURM (array job):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>#!/bin/bash -l
#SBATCH -p multicore
#SBATCH -n 2
#SBATCH -e /gpfs01/scratch/mbdxwym4/glycine_paper_geometries_gaussian_with_forces/.DATA/SCRIPTS/ERRORS/%x.e%A.%a # noqa: E501
#SBATCH -o /gpfs01/scratch/mbdxwym4/glycine_paper_geometries_gaussian_with_forces/.DATA/SCRIPTS/OUTPUTS/%x.o%A.%a # noqa: E501
#SBATCH -D /gpfs01/scratch/mbdxwym4/glycine_paper_geometries_gaussian_with_forces
#SBATCH -a 1-3965
echo &quot;Loading Modules | $(date)&quot;
module load gaussian/g16c01_em64t_detectcpu
export OMP_NUM_THREADS=2
echo &quot;Starting Job | $(date)&quot;
ICHOR_DATFILE=/gpfs01/scratch/mbdxwym4/glycine_paper_geometries_gaussian_with_forces/.DATA/JOBS/DATAFILES/78a3e81e-617e-475d-809b-01501f67bfc9 # noqa: E501
arr1=()
arr2=()
while IFS=, read -r var1 var2
do
    arr1+=($var1)
    arr2+=($var2)
done &lt; $ICHOR_DATFILE
if [ -n ${arr1[$SLURM_ARRAY_TASK_ID-1]} ] &amp;&amp; [ -n ${arr2[$SLURM_ARRAY_TASK_ID-1]} ]
then
export GAUSS_SCRDIR=$(dirname ${arr1[$SLURM_ARRAY_TASK_ID-1]})
$g16root/g16/g16 ${arr1[$SLURM_ARRAY_TASK_ID-1]} ${arr2[$SLURM_ARRAY_TASK_ID-1]}
fi
echo &quot;Finished Job | $(date)&quot;
</pre></div>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.DATAFILE">
<span class="sig-name descname"><span class="pre">DATAFILE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'ICHOR_DATFILE'</span></em><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.DATAFILE" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.SEPARATOR">
<span class="sig-name descname"><span class="pre">SEPARATOR</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">','</span></em><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.SEPARATOR" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.add_command">
<span class="sig-name descname"><span class="pre">add_command</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">command</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.add_command" title="Permalink to this definition"></a></dt>
<dd><p>Add a command to the list of commands.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.add_option">
<span class="sig-name descname"><span class="pre">add_option</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">command</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.add_option" title="Permalink to this definition"></a></dt>
<dd><p>Add a command to the list of commands.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.arr">
<span class="sig-name descname"><span class="pre">arr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.arr" title="Permalink to this definition"></a></dt>
<dd><p>Returns the keyword which is used to select array jobs.
Since array jobs start at 1 instead of 0, 1 needs to be added
to the array size.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.array_index">
<span class="sig-name descname"><span class="pre">array_index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.array_index" title="Permalink to this definition"></a></dt>
<dd><p>Returns the keywords used to run an array job through a program such as Gaussian.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For example, this line in GAUSSIAN.sh (the submission script for Gaussian) is
g09 ${arr1[$SGE_TASK_ID-1]} ${arr2[$SGE_TASK_ID-1]}
The g09 is the program (however this depend on which system you are on).
The rest is what is returned by this method.</p>
</div>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.bash_date">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">bash_date</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.bash_date" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.default_options">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">default_options</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.default_options" title="Permalink to this definition"></a></dt>
<dd><p>Returns a list of default options to use in a submission script for a job.
This list containing the current working directory, the output directory (where .o files are written),
the errors directory (where .e files are written). If the number of cores is more than 1, the keyword
needed when specifying more than 1 cores is also written to the options list. This keyword depends on
the system on which the job is ran, as well as on the number of cores that the job needs.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.filetype">
<span class="sig-name descname"><span class="pre">filetype</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'.sh'</span></em><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.filetype" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.generate_str_for_reading_datafile">
<span class="sig-name descname"><span class="pre">generate_str_for_reading_datafile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datafile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.generate_str_for_reading_datafile" title="Permalink to this definition"></a></dt>
<dd><p>Forms the strings for array jobs which are then written to the submission script to specify the number of
tasks in the array job and things like that. Easiest to see if you
have GAUSSIAN.sh or another submission script opened.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.grouped_commands">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">grouped_commands</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ichor.hpc.submission_script.command_group.CommandGroup" title="ichor.hpc.submission_script.command_group.CommandGroup"><span class="pre">CommandGroup</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.grouped_commands" title="Permalink to this definition"></a></dt>
<dd><p>Group commands if they need to be submitted into an array job.
These commands will all be the same type, i.e. they will all be Gaussian jobs,
or AIMALL jobs. Sometimes ICHOR needs to be ran after the job is complete
(for example ICHOR needs to be ran after a FEREBUS job in order to do adaptive sampling).</p>
<p>e.g. if we had a list of commands like the following:
[Gaussian, Gaussian, Ichor, AIMAll, AIMAll]
The commands will be grouped by type:
[[Gaussian, Gaussian], [Ichor], [AIMAll, AIMAll]]</p>
<p>The groupings are then used to allocate a task array to the batch system</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.modules">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">modules</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.modules" title="Permalink to this definition"></a></dt>
<dd><p>Returns a list of modules that need to be loaded before a job can be ran.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.options">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">options</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.options" title="Permalink to this definition"></a></dt>
<dd><p>Return the complete list of options (default options + other options that are specific to the job).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.setup_datafile">
<span class="sig-name descname"><span class="pre">setup_datafile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datafile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.setup_datafile" title="Permalink to this definition"></a></dt>
<dd><p>Calls write_datafile which writes the datafile to disk (if it is not locked). Then it reads</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>datafile</strong> – Path object that points to a datafile location
(which is going to be written now by write_datafile)</p></li>
<li><p><strong>data</strong> – A list of lists. Each inner list contains strings
which are the names of the inputs and output files.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.submit">
<span class="sig-name descname"><span class="pre">submit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hold</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="ichor.hpc.batch_system.html#ichor.hpc.batch_system.jobs.JobID" title="ichor.hpc.batch_system.jobs.JobID"><span class="pre">JobID</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="ichor.hpc.batch_system.html#ichor.hpc.batch_system.jobs.JobID" title="ichor.hpc.batch_system.jobs.JobID"><span class="pre">JobID</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.submit" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.test_array_not_null">
<span class="sig-name descname"><span class="pre">test_array_not_null</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.test_array_not_null" title="Permalink to this definition"></a></dt>
<dd><p>Returns a string which is used in bash to test if an array entry is not null or empty.
We need to test this because there could be cases where there are 2000 SGE tasks for example,
but there are only 1990 jobs (because points have been scrubbed in the previous step).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>the [ -n is used for the test program in bash which makes sure array entry is not null with -n</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.var">
<span class="sig-name descname"><span class="pre">var</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.var" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.write">
<span class="sig-name descname"><span class="pre">write</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.write" title="Permalink to this definition"></a></dt>
<dd><p>Writes the submission script that is passed to the queuing system.
The options for the job (such as directory, number of jobs, core count, etc.)
are written at the top of the file. The commands to run (such as Gaussian, AIMALL, etc.)
are written below the options.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.submission_script.SubmissionScript.write_datafile">
<span class="sig-name descname"><span class="pre">write_datafile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datafile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ichor.hpc.submission_script.submission_script.SubmissionScript.write_datafile" title="Permalink to this definition"></a></dt>
<dd><p>Write the datafile to disk. All datafiles are stored in
self.datafile_path . Each line of the
datafile contains text that corresponds to the inputs and output file names.
These are separated by self.separator, which is a comma.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For example, a datafile, which has a random name (which is set by self.uid) contains lines in the form of:
WATER0001.gjf,WATER0001.gau
WATER0002.gjf,WATER0002.gau
…</p>
</div>
</dd></dl>

</dd></dl>

</section>
<section id="module-ichor.hpc.submission_script">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-ichor.hpc.submission_script" title="Permalink to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">SubmissionScript</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">submission_script_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ncores</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cwd</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_nodes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_nodes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_running_tasks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputs_dir_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">errors_dir_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datafile_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class that can be used to construct submission scripts for various programs such as Gaussian and AIMALL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> – A path to a submission script (such as GAUSSIAN.sh and AIMALL.sh).
These .sh files are submitted as jobs to CSF3/FFLUXLAB.
These job scripts will have different contents depending on the number of cores selected,
the number of tasks to do (if running an array job), etc.,
so they need to be written out dynamically depending on what is going to be ran.</p></li>
<li><p><strong>submission_script_name</strong> – The name of the submission script</p></li>
<li><p><strong>ncores</strong> – Number of cores to run the job with</p></li>
<li><p><strong>cwd</strong> – The current working directory. If not set, defaults to Path.cwd()</p></li>
<li><p><strong>include_nodes</strong> – A list of node names to run the job on, defaults to None</p></li>
<li><p><strong>exclude_nodes</strong> – A list of node names to exclude running the job on, defaults to None</p></li>
<li><p><strong>max_running_tasks</strong> – Maximum number of tasks (of array job) that can run at once, defaults to -1</p></li>
<li><p><strong>outputs_dir_path</strong> – Path to the outputs directory. If not set, it will use the default global_variables one</p></li>
<li><p><strong>errors_dir_path</strong> – Path to the errors directory. If not set, it will use the default global_variables one</p></li>
<li><p><strong>datafile_path</strong> – Path to datafile containing information needed for job to run, defaults to None</p></li>
</ul>
</dd>
</dl>
<p>Example Gaussian submission script for SGE (array job):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>#!/bin/bash -l
#$ -o /net/scratch2/mbdxwym4/ammonia_with_derivatives/.DATA/SCRIPTS/OUTPUTS
#$ -pe smp.pe 2
#$ -wd /net/scratch2/mbdxwym4/ammonia_with_derivatives
#$ -e /net/scratch2/mbdxwym4/ammonia_with_derivatives/.DATA/SCRIPTS/ERRORS
#$ -t 1-10000
echo &quot;Loading Modules | $(date)&quot;
module load apps/binapps/gaussian/g09d01_em64t
export OMP_NUM_THREADS=2
echo &quot;Starting Job | $(date)&quot;
ICHOR_DATFILE=/net/scratch2/mbdxwym4/ammonia_with_derivatives/.DATA/JOBS/DATAFILES/dd644974-c430-449a-a8e1-d3540980bcb4
arr1=()
arr2=()
while IFS=, read -r var1 var2
do
    arr1+=($var1)
    arr2+=($var2)
done &lt; $ICHOR_DATFILE
if [ -n ${arr1[$SGE_TASK_ID-1]} ] &amp;&amp; [ -n ${arr2[$SGE_TASK_ID-1]} ]
then
export GAUSS_SCRDIR=$(dirname ${arr1[$SGE_TASK_ID-1]})
$g09root/g09/g09 ${arr1[$SGE_TASK_ID-1]} ${arr2[$SGE_TASK_ID-1]}
fi
echo &quot;Finished Job | $(date)&quot;
</pre></div>
</div>
<p>Example Gaussian submission script for SLURM (array job):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>#!/bin/bash -l
#SBATCH -p multicore
#SBATCH -n 2
#SBATCH -e /gpfs01/scratch/mbdxwym4/glycine_paper_geometries_gaussian_with_forces/.DATA/SCRIPTS/ERRORS/%x.e%A.%a # noqa: E501
#SBATCH -o /gpfs01/scratch/mbdxwym4/glycine_paper_geometries_gaussian_with_forces/.DATA/SCRIPTS/OUTPUTS/%x.o%A.%a # noqa: E501
#SBATCH -D /gpfs01/scratch/mbdxwym4/glycine_paper_geometries_gaussian_with_forces
#SBATCH -a 1-3965
echo &quot;Loading Modules | $(date)&quot;
module load gaussian/g16c01_em64t_detectcpu
export OMP_NUM_THREADS=2
echo &quot;Starting Job | $(date)&quot;
ICHOR_DATFILE=/gpfs01/scratch/mbdxwym4/glycine_paper_geometries_gaussian_with_forces/.DATA/JOBS/DATAFILES/78a3e81e-617e-475d-809b-01501f67bfc9 # noqa: E501
arr1=()
arr2=()
while IFS=, read -r var1 var2
do
    arr1+=($var1)
    arr2+=($var2)
done &lt; $ICHOR_DATFILE
if [ -n ${arr1[$SLURM_ARRAY_TASK_ID-1]} ] &amp;&amp; [ -n ${arr2[$SLURM_ARRAY_TASK_ID-1]} ]
then
export GAUSS_SCRDIR=$(dirname ${arr1[$SLURM_ARRAY_TASK_ID-1]})
$g16root/g16/g16 ${arr1[$SLURM_ARRAY_TASK_ID-1]} ${arr2[$SLURM_ARRAY_TASK_ID-1]}
fi
echo &quot;Finished Job | $(date)&quot;
</pre></div>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.DATAFILE">
<span class="sig-name descname"><span class="pre">DATAFILE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'ICHOR_DATFILE'</span></em><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.DATAFILE" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.SEPARATOR">
<span class="sig-name descname"><span class="pre">SEPARATOR</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">','</span></em><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.SEPARATOR" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.add_command">
<span class="sig-name descname"><span class="pre">add_command</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">command</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.add_command" title="Permalink to this definition"></a></dt>
<dd><p>Add a command to the list of commands.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.add_option">
<span class="sig-name descname"><span class="pre">add_option</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">command</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.add_option" title="Permalink to this definition"></a></dt>
<dd><p>Add a command to the list of commands.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.arr">
<span class="sig-name descname"><span class="pre">arr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.arr" title="Permalink to this definition"></a></dt>
<dd><p>Returns the keyword which is used to select array jobs.
Since array jobs start at 1 instead of 0, 1 needs to be added
to the array size.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.array_index">
<span class="sig-name descname"><span class="pre">array_index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.array_index" title="Permalink to this definition"></a></dt>
<dd><p>Returns the keywords used to run an array job through a program such as Gaussian.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For example, this line in GAUSSIAN.sh (the submission script for Gaussian) is
g09 ${arr1[$SGE_TASK_ID-1]} ${arr2[$SGE_TASK_ID-1]}
The g09 is the program (however this depend on which system you are on).
The rest is what is returned by this method.</p>
</div>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.bash_date">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">bash_date</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.bash_date" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.default_options">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">default_options</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.default_options" title="Permalink to this definition"></a></dt>
<dd><p>Returns a list of default options to use in a submission script for a job.
This list containing the current working directory, the output directory (where .o files are written),
the errors directory (where .e files are written). If the number of cores is more than 1, the keyword
needed when specifying more than 1 cores is also written to the options list. This keyword depends on
the system on which the job is ran, as well as on the number of cores that the job needs.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.filetype">
<span class="sig-name descname"><span class="pre">filetype</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'.sh'</span></em><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.filetype" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.generate_str_for_reading_datafile">
<span class="sig-name descname"><span class="pre">generate_str_for_reading_datafile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datafile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.generate_str_for_reading_datafile" title="Permalink to this definition"></a></dt>
<dd><p>Forms the strings for array jobs which are then written to the submission script to specify the number of
tasks in the array job and things like that. Easiest to see if you
have GAUSSIAN.sh or another submission script opened.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.grouped_commands">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">grouped_commands</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#ichor.hpc.submission_script.command_group.CommandGroup" title="ichor.hpc.submission_script.command_group.CommandGroup"><span class="pre">CommandGroup</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.grouped_commands" title="Permalink to this definition"></a></dt>
<dd><p>Group commands if they need to be submitted into an array job.
These commands will all be the same type, i.e. they will all be Gaussian jobs,
or AIMALL jobs. Sometimes ICHOR needs to be ran after the job is complete
(for example ICHOR needs to be ran after a FEREBUS job in order to do adaptive sampling).</p>
<p>e.g. if we had a list of commands like the following:
[Gaussian, Gaussian, Ichor, AIMAll, AIMAll]
The commands will be grouped by type:
[[Gaussian, Gaussian], [Ichor], [AIMAll, AIMAll]]</p>
<p>The groupings are then used to allocate a task array to the batch system</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.modules">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">modules</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.modules" title="Permalink to this definition"></a></dt>
<dd><p>Returns a list of modules that need to be loaded before a job can be ran.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.options">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">options</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.options" title="Permalink to this definition"></a></dt>
<dd><p>Return the complete list of options (default options + other options that are specific to the job).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.setup_datafile">
<span class="sig-name descname"><span class="pre">setup_datafile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datafile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.setup_datafile" title="Permalink to this definition"></a></dt>
<dd><p>Calls write_datafile which writes the datafile to disk (if it is not locked). Then it reads</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>datafile</strong> – Path object that points to a datafile location
(which is going to be written now by write_datafile)</p></li>
<li><p><strong>data</strong> – A list of lists. Each inner list contains strings
which are the names of the inputs and output files.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.submit">
<span class="sig-name descname"><span class="pre">submit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hold</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="ichor.hpc.batch_system.html#ichor.hpc.batch_system.jobs.JobID" title="ichor.hpc.batch_system.jobs.JobID"><span class="pre">JobID</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="ichor.hpc.batch_system.html#ichor.hpc.batch_system.jobs.JobID" title="ichor.hpc.batch_system.jobs.JobID"><span class="pre">JobID</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.submit" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.test_array_not_null">
<span class="sig-name descname"><span class="pre">test_array_not_null</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.test_array_not_null" title="Permalink to this definition"></a></dt>
<dd><p>Returns a string which is used in bash to test if an array entry is not null or empty.
We need to test this because there could be cases where there are 2000 SGE tasks for example,
but there are only 1990 jobs (because points have been scrubbed in the previous step).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>the [ -n is used for the test program in bash which makes sure array entry is not null with -n</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.var">
<span class="sig-name descname"><span class="pre">var</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.var" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.write">
<span class="sig-name descname"><span class="pre">write</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.write" title="Permalink to this definition"></a></dt>
<dd><p>Writes the submission script that is passed to the queuing system.
The options for the job (such as directory, number of jobs, core count, etc.)
are written at the top of the file. The commands to run (such as Gaussian, AIMALL, etc.)
are written below the options.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ichor.hpc.submission_script.SubmissionScript.write_datafile">
<span class="sig-name descname"><span class="pre">write_datafile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datafile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#ichor.hpc.submission_script.SubmissionScript.write_datafile" title="Permalink to this definition"></a></dt>
<dd><p>Write the datafile to disk. All datafiles are stored in
self.datafile_path . Each line of the
datafile contains text that corresponds to the inputs and output file names.
These are separated by self.separator, which is a comma.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For example, a datafile, which has a random name (which is set by self.uid) contains lines in the form of:
WATER0001.gjf,WATER0001.gau
WATER0002.gjf,WATER0002.gau
…</p>
</div>
</dd></dl>

</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ichor.hpc.submission_commands.html" class="btn btn-neutral float-left" title="ichor.hpc.submission_commands package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ichor.hpc.useful_functions.html" class="btn btn-neutral float-right" title="ichor.hpc.useful_functions package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Yulian Manchev.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

</body>
</html>
